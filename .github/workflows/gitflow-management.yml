name: GitFlow分支管理

on:
  push:
    branches: [ main, develop ]

jobs:
  branch-protection:
    runs-on: ubuntu-latest
    steps:
      - name: 设置分支保护规则
        run: |
          echo "GitFlow分支策略已启用"
          echo "主分支: main"
          echo "开发分支: develop"
          echo "支持的分支类型: feature/, hotfix/, release/"
          
      - name: 分支策略验证
        run: |
          BRANCH_NAME=${{ github.ref_name }}
          
          # 检查分支命名规范
          if [[ "$BRANCH_NAME" =~ ^(feature|hotfix|release)/[a-zA-Z0-9_-]+$ ]] || [[ "$BRANCH_NAME" =~ ^(main|develop)$ ]]; then
            echo "✅ 分支命名符合GitFlow规范"
          else
            echo "❌ 分支命名不符合GitFlow规范"
            echo "允许的分支类型:"
            echo "  - main (主分支)"
            echo "  - develop (开发分支)"
            echo "  - feature/* (功能分支)"
            echo "  - hotfix/* (热修复分支)"
            echo "  - release/* (发布分支)"
            exit 1
          fi