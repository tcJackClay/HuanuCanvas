# 代码审查指南

## 📋 审查概述

代码审查是确保代码质量和项目健康的重要环节。本指南为HuanuCanvas项目的代码审查提供标准和最佳实践。

## 👥 审查角色

### 审查者职责
- **主要审查者**: 负责整体审查和质量把关
- **次要审查者**: 关注特定方面（如安全、性能）
- **最终批准者**: 负责合并决策

### 作者职责
- **准备阶段**: 确保代码符合审查标准
- **响应阶段**: 及时回复审查意见
- **修改阶段**: 根据反馈进行必要修改

## 🎯 审查标准

### 功能正确性
- [ ] **功能实现**: 代码正确实现需求
- [ ] **边界条件**: 适当处理边界情况
- [ ] **错误处理**: 合理处理异常情况
- [ ] **数据验证**: 输入验证和清理

### 代码质量
- [ ] **可读性**: 代码清晰易懂
- [ ] **可维护性**: 代码结构良好
- [ ] **可测试性**: 代码易于测试
- [ ] **可重用性**: 避免重复代码

### 性能考虑
- [ ] **算法效率**: 使用合适的算法
- [ ] **内存使用**: 避免内存泄漏
- [ ] **并发处理**: 正确处理并发情况
- [ ] **资源管理**: 合理管理文件、网络等资源

### 安全性
- [ ] **输入验证**: 验证用户输入
- [ ] **权限控制**: 适当的权限检查
- [ ] **敏感信息**: 不泄露敏感数据
- [ ] **依赖安全**: 使用安全的依赖库

## 📝 审查清单

### 代码结构
- [ ] **单一职责**: 每个函数/类职责单一
- [ ] **模块化**: 代码模块化良好
- [ ] **依赖管理**: 依赖关系清晰
- [ ] **接口设计**: API设计合理

### 命名规范
- [ ] **变量命名**: 有意义且一致
- [ ] **函数命名**: 动词开头，描述清晰
- [ ] **类命名**: 名词开头，符合规范
- [ ] **常量命名**: 全大写，语义清晰

### 注释和文档
- [ ] **函数注释**: 完整的JSDoc
- [ ] **复杂逻辑**: 必要的行内注释
- [ ] **README更新**: 文档及时更新
- [ ] **变更说明**: PR描述清晰

### 测试覆盖
- [ ] **单元测试**: 新功能有单元测试
- [ ] **集成测试**: 相关集成测试通过
- [ ] **测试质量**: 测试用例合理
- [ ] **覆盖率**: 测试覆盖率达标

### 性能优化
- [ ] **不早优化**: 避免不必要的优化
- [ ] **性能分析**: 基于分析进行优化
- [ ] **可读性**: 优化不影响可读性
- [ ] **基准测试**: 性能改进有数据支持

## 🔍 审查流程

### 阶段1: 初步审查 (1-2小时)
1. **查看变更概览**: 了解PR的整体范围
2. **检查基本信息**: 分支、标题、描述
3. **运行基本检查**: CI状态、测试结果
4. **快速浏览**: 识别明显问题

### 阶段2: 详细审查 (4-8小时)
1. **逐文件审查**: 仔细审查每个文件
2. **逻辑检查**: 验证算法和逻辑
3. **设计审查**: 评估架构设计
4. **最佳实践**: 检查是否遵循最佳实践

### 阶段3: 综合评估 (1-2小时)
1. **整体评估**: 评估整体质量
2. **风险评估**: 识别潜在风险
3. **建议反馈**: 提供建设性建议
4. **决策**: 决定批准、请求修改或拒绝

## 💬 反馈类型

### 阻塞性问题 (Must Fix)
- 功能错误或缺陷
- 安全漏洞
- 性能严重问题
- 违反项目规范

**反馈格式**:
```
🔴 [BLOCKER] 问题描述

原因: 详细说明为什么这是问题
影响: 说明问题的影响
建议: 提出具体的解决方案
```

### 重要问题 (Should Fix)
- 代码质量问题
- 设计改进建议
- 性能优化机会
- 安全性增强

**反馈格式**:
```
🟡 [SHOULD FIX] 问题描述

原因: 说明改进的必要性
建议: 提出具体的改进方案
优先级: 高/中/低
```

### 建议改进 (Could Fix)
- 代码风格问题
- 注释补充
- 重构建议
- 文档改进

**反馈格式**:
```
🟢 [SUGGESTION] 建议描述

原因: 说明建议的价值
选项: 提供多个选择方案
影响: 评估实现成本
```

### 积极反馈 (Praise)
- 优秀的解决方案
- 创新的实现
- 清晰的代码
- 完善的测试

**反馈格式**:
```
✨ [PRAISE] 优秀实现

亮点: 详细说明优秀之处
启发: 可供其他人学习的要点
```

## 🛠️ 审查工具

### GitHub界面
- **Diff视图**: 查看具体变更
- **评论系统**: 添加审查意见
- **状态管理**: 跟踪审查进度
- **通知系统**: 及时获取更新

### 审查技巧
- **先宏观后微观**: 先看整体再看细节
- **重点关注**: 关注核心功能和关键逻辑
- **假设验证**: 验证作者的假设是否正确
- **测试思考**: 从测试角度考虑代码

### 常见问题识别
```javascript
// 1. 魔法数字
if (status === 200) { /* ... */ }
// 建议: 使用常量

// 2. 深层嵌套
if (user) {
  if (user.profile) {
    if (user.profile.settings) {
      // ...
    }
  }
}
// 建议: 早期返回模式

// 3. 长函数
function processUserData(data) {
  // 50+ 行代码
}
// 建议: 拆分成小函数

// 4. 重复代码
if (user.isActive) {
  // 处理活跃用户
}
// 在多个地方重复
// 建议: 提取公共函数
```

## 🎯 审查最佳实践

### 对作者的建议
1. **准备充分**: 提交前自我审查
2. **描述清晰**: PR描述详细完整
3. **响应及时**: 及时回复审查意见
4. **保持开放**: 接受建设性批评
5. **解释充分**: 为设计决策提供理由

### 对审查者的建议
1. **及时审查**: 在24小时内完成审查
2. **建设性**: 提供具体可行的建议
3. **尊重**: 保持专业和尊重的态度
4. **平衡**: 平衡严格性和实用性
5. **学习**: 从每次审查中学习

### 团队协作
1. **知识分享**: 在审查中分享知识
2. **标准一致**: 团队保持一致标准
3. **轮流审查**: 避免固定审查者
4. **持续改进**: 不断优化审查流程

## 📊 审查指标

### 质量指标
- **审查时间**: 平均审查时间
- **修改轮次**: PR通过的平均轮次
- **阻塞率**: 阻塞性问题比例
- **通过率**: 首次审查通过率

### 效率指标
- **响应时间**: 从提交到首次反馈时间
- **完成时间**: 从提交到合并时间
- **审查负载**: 每人每周审查量

### 学习指标
- **知识转移**: 审查中的学习效果
- **标准提升**: 代码质量提升趋势
- **团队成长**: 团队整体能力提升

## 🔧 自动化审查

### 静态分析
- **ESLint**: 代码规范检查
- **TypeScript**: 类型检查
- **SonarQube**: 代码质量分析
- **CodeQL**: 安全漏洞检测

### 工具配置
```yaml
# .github/workflows/code-review.yml
name: 代码质量检查
on: [pull_request]

jobs:
  code-quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: 运行ESLint
        run: npm run lint
      - name: 运行TypeScript检查
        run: npm run type-check
      - name: 运行测试
        run: npm test
```

## 📚 相关资源

- [GitHub代码审查文档](https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/about-code-scanning)
- [Google代码审查标准](https://google.github.io/eng-practices/review/)
- [约定式提交](https://www.conventionalcommits.org/)
- [项目代码规范](./CODING_STANDARDS.md)

## 📞 支持

如果您对代码审查流程有疑问:

1. **查看文档**: 仔细阅读此指南
2. **咨询团队**: 向团队成员寻求建议
3. **创建讨论**: 在GitHub Discussions中讨论
4. **培训**: 参加代码审查培训

---

**记住**: 代码审查是团队协作和学习的重要机会，让我们共同维护项目的高质量标准！