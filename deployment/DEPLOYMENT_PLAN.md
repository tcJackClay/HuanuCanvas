# HuanuCanvasé¡¹ç›®è¯¦ç»†éƒ¨ç½²è®¡åˆ’

**ç‰ˆæœ¬**: v1.4.1  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-27  
**æœ€åæ›´æ–°**: 2026-01-27

---

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²ç­–ç•¥åˆ†æ](#1-éƒ¨ç½²ç­–ç•¥åˆ†æ)
2. [éƒ¨ç½²é…ç½®è®¾è®¡](#2-éƒ¨ç½²é…ç½®è®¾è®¡)
3. [åˆ†é˜¶æ®µéƒ¨ç½²è®¡åˆ’](#3-åˆ†é˜¶æ®µéƒ¨ç½²è®¡åˆ’)
4. [é£é™©è¯„ä¼°å’Œç¼“è§£](#4-é£é™©è¯„ä¼°å’Œç¼“è§£)
5. [å…·ä½“æ‰§è¡Œæ­¥éª¤](#5-å…·ä½“æ‰§è¡Œæ­¥éª¤)
6. [ç»´æŠ¤å’Œç›‘æ§](#6-ç»´æŠ¤å’Œç›‘æ§)

---

## 1. éƒ¨ç½²ç­–ç•¥åˆ†æ

### 1.1 é¡¹ç›®æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HuanuCanvas æ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰ç«¯ (React 19 + Vite)    â”‚  åç«¯ (Node.js API)            â”‚
â”‚  ç«¯å£: 5206/80             â”‚  ç«¯å£: 8765                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Electron æ¡Œé¢åº”ç”¨ä¸»è¿›ç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Google Gemini AI é›†æˆ                         â”‚
â”‚              ç«¯å£: 443 (HTTPS)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 éƒ¨ç½²å¹³å°å¯¹æ¯”

| æ–¹æ¡ˆ | é˜¿é‡Œäº‘ | è‡ªæ‰˜ç®¡ | Docker |
|------|--------|--------|--------|
| **é€‚ç”¨è§„æ¨¡** | ä¸­å¤§å‹ä¼ä¸š | å°å›¢é˜Ÿ/å†…ç½‘ | æ‰€æœ‰è§„æ¨¡ |
| **æˆæœ¬** | è¾ƒé«˜ | ä¸­ç­‰ | ä½-ä¸­ç­‰ |
| **ç»´æŠ¤éš¾åº¦** | ä½ | é«˜ | ä¸­ç­‰ |
| **æ‰©å±•æ€§** | é«˜ | ä¸­ç­‰ | é«˜ |
| **å®‰å…¨æ€§** | é«˜ | å–å†³äºé…ç½® | é«˜ |
| **æ¨èæŒ‡æ•°** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |

### 1.3 æ¨èéƒ¨ç½²æ–¹æ¡ˆ

**æœ€ä½³å®è·µ**: Docker + è‡ªæ‰˜ç®¡æ··åˆæ–¹æ¡ˆ
- å¼€å‘ç¯å¢ƒï¼šDocker Compose
- æµ‹è¯•ç¯å¢ƒï¼šDocker + åŸºç¡€ç›‘æ§
- ç”Ÿäº§ç¯å¢ƒï¼šDocker + Kubernetes + å®Œæ•´ç›‘æ§

---

## 2. éƒ¨ç½²é…ç½®è®¾è®¡

### 2.1 æ–‡ä»¶ç»“æ„

```
deployment/
â”œâ”€â”€ deployment.yaml          # Kuberneteséƒ¨ç½²é…ç½®
â”œâ”€â”€ docker-compose.yml       # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile.frontend       # å‰ç«¯Dockerfile
â”œâ”€â”€ Dockerfile.backend        # åç«¯Dockerfile
â”œâ”€â”€ nginx.conf               # Nginxé…ç½®
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ monitoring/
â”‚   â”œâ”€â”€ prometheus.yml       # Prometheusé…ç½®
â”‚   â””â”€â”€ grafana/            # Grafanaä»ªè¡¨æ¿
â””â”€â”€ scripts/
    â”œâ”€â”€ deploy.sh            # éƒ¨ç½²è„šæœ¬
    â”œâ”€â”€ backup.sh            # å¤‡ä»½è„šæœ¬
    â””â”€â”€ health-check.sh      # å¥åº·æ£€æŸ¥è„šæœ¬
```

### 2.2 ç¯å¢ƒå˜é‡ç®¡ç†

#### å¿…éœ€ç¯å¢ƒå˜é‡
```bash
# APIå¯†é’¥ (å…³é”®)
GEMINI_API_KEY=your_gemini_api_key

# åº”ç”¨é…ç½®
NODE_ENV=production
APP_VERSION=1.4.1

# æœåŠ¡ç«¯å£
FRONTEND_PORT=80
BACKEND_PORT=8765
```

#### å¯é€‰ç¯å¢ƒå˜é‡
```bash
# æ•°æ®åº“é…ç½®
POSTGRES_PASSWORD=secure_password
DATABASE_URL=postgresql://user:pass@host:5432/db

# ç›‘æ§é…ç½®
GRAFANA_PASSWORD=admin_password
PROMETHEUS_PORT=9090

# å­˜å‚¨è·¯å¾„
DATA_PATH=/app/data
OUTPUT_PATH=/app/output
```

### 2.3 æœåŠ¡æ¶æ„

```yaml
æœåŠ¡å±‚æ¬¡:
â”œâ”€â”€ è´Ÿè½½å‡è¡¡å±‚ (Nginx)
â”œâ”€â”€ å‰ç«¯å±‚ (React + Viteæ„å»º)
â”œâ”€â”€ APIå±‚ (Node.jsä»£ç†æœåŠ¡å™¨)
â”œâ”€â”€ æ•°æ®å±‚ (æ–‡ä»¶ç³»ç»Ÿ/PostgreSQL)
â””â”€â”€ ç›‘æ§å±‚ (Prometheus + Grafana)
```

---

## 3. åˆ†é˜¶æ®µéƒ¨ç½²è®¡åˆ’

### 3.1 é˜¶æ®µ1: é¡¹ç›®å¤‡ä»½å’Œå‡†å¤‡å·¥ä½œ (é¢„è®¡1å°æ—¶)

**ç›®æ ‡**: ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œå®Œæˆéƒ¨ç½²å‰å‡†å¤‡

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] åˆ›å»ºé¡¹ç›®å®Œæ•´å¤‡ä»½
- [ ] éªŒè¯æºä»£ç å®Œæ•´æ€§
- [ ] å‡†å¤‡éƒ¨ç½²ç¯å¢ƒ
- [ ] ç¡®è®¤åŸŸåå’ŒSSLè¯ä¹¦

**æ£€æŸ¥ç‚¹**:
- å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§éªŒè¯ âœ…
- æºä»£ç ç‰ˆæœ¬å·ç¡®è®¤ âœ…
- ç¯å¢ƒå¯ç”¨æ€§æ£€æŸ¥ âœ…

**å‘½ä»¤åºåˆ—**:
```bash
# 1. åˆ›å»ºå¤‡ä»½
tar -czf huanu-backup-$(date +%Y%m%d_%H%M%S).tar.gz /path/to/huanu-canvas

# 2. éªŒè¯æºä»£ç 
git status
git log --oneline -5

# 3. ç¯å¢ƒæ£€æŸ¥
docker --version
docker-compose --version
node --version
npm --version
```

### 3.2 é˜¶æ®µ2: ç¯å¢ƒæ­å»ºå’Œä¾èµ–å®‰è£… (é¢„è®¡2å°æ—¶)

**ç›®æ ‡**: é…ç½®Dockerç¯å¢ƒï¼Œå®‰è£…å¿…è¦ä¾èµ–

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®‰è£…Dockerå’ŒDocker Compose
- [ ] é…ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶
- [ ] æ‹‰å–åŸºç¡€é•œåƒ
- [ ] åˆå§‹åŒ–æ•°æ®ç›®å½•

**æ£€æŸ¥ç‚¹**:
- DockeræœåŠ¡æ­£å¸¸è¿è¡Œ âœ…
- ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡® âœ…
- åŸºç¡€é•œåƒä¸‹è½½å®Œæˆ âœ…

**å‘½ä»¤åºåˆ—**:
```bash
# 1. å®‰è£…Docker (Ubuntu/Debian)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 2. å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp deployment/.env.example .env
nano .env  # ç¼–è¾‘å®é™…é…ç½®

# 4. æ‹‰å–é•œåƒ
docker pull node:18-alpine
docker pull nginx:alpine
docker pull redis:7-alpine
docker pull postgres:15-alpine
```

### 3.3 é˜¶æ®µ3: åº”ç”¨æ„å»ºå’Œä¼˜åŒ– (é¢„è®¡1.5å°æ—¶)

**ç›®æ ‡**: æ„å»ºå‰ç«¯åº”ç”¨ï¼Œå‡†å¤‡åç«¯æœåŠ¡

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å‰ç«¯åº”ç”¨æ„å»º
- [ ] åç«¯ä¾èµ–å®‰è£…
- [ ] æ€§èƒ½ä¼˜åŒ–é…ç½®
- [ ] å®‰å…¨åŠ å›ºè®¾ç½®

**æ£€æŸ¥ç‚¹**:
- å‰ç«¯æ„å»ºæˆåŠŸ âœ…
- èµ„æºæ–‡ä»¶ä¼˜åŒ–å®Œæˆ âœ…
- å®‰å…¨é…ç½®ç”Ÿæ•ˆ âœ…

**å‘½ä»¤åºåˆ—**:
```bash
# 1. æ„å»ºå‰ç«¯
cd HuanuCanvas
npm ci
npm run build

# 2. æ„å»ºDockeré•œåƒ
docker build -f deployment/Dockerfile.frontend -t huanu-canvas:v1.4.1 .
docker build -f deployment/Dockerfile.backend -t huanu-backend:v1.4.1 .

# 3. éªŒè¯æ„å»º
docker images | grep huanu
```

### 3.4 é˜¶æ®µ4: éƒ¨ç½²æ‰§è¡Œå’ŒéªŒè¯ (é¢„è®¡1å°æ—¶)

**ç›®æ ‡**: å¯åŠ¨æœåŠ¡ï¼Œè¿›è¡Œå…¨é¢éªŒè¯

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å¯åŠ¨æ‰€æœ‰æœåŠ¡
- [ ] å¥åº·æ£€æŸ¥éªŒè¯
- [ ] åŠŸèƒ½æµ‹è¯•ç¡®è®¤
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

**æ£€æŸ¥ç‚¹**:
- æ‰€æœ‰æœåŠ¡å¯åŠ¨æˆåŠŸ âœ…
- å¥åº·æ£€æŸ¥é€šè¿‡ âœ…
- æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ âœ…

**å‘½ä»¤åºåˆ—**:
```bash
# 1. å¯åŠ¨æœåŠ¡
docker-compose -f deployment/docker-compose.yml up -d

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
docker-compose logs frontend
docker-compose logs backend

# 3. å¥åº·æ£€æŸ¥
curl -f http://localhost/health
curl -f http://localhost/api/health

# 4. åŠŸèƒ½æµ‹è¯•
npm test
```

### 3.5 é˜¶æ®µ5: ç›‘æ§è®¾ç½®å’Œç»´æŠ¤è®¡åˆ’ (é¢„è®¡0.5å°æ—¶)

**ç›®æ ‡**: éƒ¨ç½²ç›‘æ§ï¼Œé…ç½®å‘Šè­¦

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å¯åŠ¨ç›‘æ§æœåŠ¡
- [ ] é…ç½®Grafanaä»ªè¡¨æ¿
- [ ] è®¾ç½®å‘Šè­¦è§„åˆ™
- [ ] åˆ›å»ºç»´æŠ¤æ–‡æ¡£

**æ£€æŸ¥ç‚¹**:
- ç›‘æ§æ•°æ®æ­£å¸¸æ”¶é›† âœ…
- å‘Šè­¦è§„åˆ™é…ç½®æ­£ç¡® âœ…
- ç»´æŠ¤è®¡åˆ’æ–‡æ¡£å®Œæ•´ âœ…

**å‘½ä»¤åºåˆ—**:
```bash
# 1. å¯åŠ¨ç›‘æ§
docker-compose -f deployment/docker-compose.yml up -d prometheus grafana

# 2. éªŒè¯ç›‘æ§
curl http://localhost:9090/-/healthy
curl http://localhost:3000/api/health

# 3. é…ç½®è‡ªåŠ¨é‡å¯
echo "@reboot cd /path/to/huanu-canvas && docker-compose -f deployment/docker-compose.yml up -d" | crontab -
```

---

## 4. é£é™©è¯„ä¼°å’Œç¼“è§£

### 4.1 æŠ€æœ¯é£é™©è¯„ä¼°

| é£é™©ç±»å‹ | é£é™©ç­‰çº§ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|---------|---------|------|----------|
| **ä¾èµ–ç‰ˆæœ¬å†²çª** | ä¸­ | ä¸­ | ä½¿ç”¨Dockerå›ºå®šç‰ˆæœ¬ï¼Œé”ä¾èµ–æ–‡ä»¶ |
| **å†…å­˜æ³„æ¼** | ä¸­ | é«˜ | ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œè®¾ç½®é‡å¯ç­–ç•¥ |
| **APIå¯†é’¥æ³„éœ²** | é«˜ | æé«˜ | ç¯å¢ƒå˜é‡ç®¡ç†ï¼Œå®šæœŸè½®æ¢å¯†é’¥ |
| **ç½‘ç»œå»¶è¿Ÿ** | ä½ | ä¸­ | CDNåŠ é€Ÿï¼Œç¼“å­˜ä¼˜åŒ– |
| **å¹¶å‘æ€§èƒ½** | ä¸­ | ä¸­ | è´Ÿè½½å‡è¡¡ï¼Œæ°´å¹³æ‰©å±• |

### 4.2 è¿è¥é£é™©è¯„ä¼°

| é£é™©ç±»å‹ | é£é™©ç­‰çº§ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|---------|---------|------|----------|
| **æ•°æ®ä¸¢å¤±** | æé«˜ | æé«˜ | å®šæœŸå¤‡ä»½ï¼Œå¤šåœ°å­˜å‚¨ |
| **æœåŠ¡ä¸­æ–­** | é«˜ | é«˜ | è´Ÿè½½å‡è¡¡ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§» |
| **å®‰å…¨æ¼æ´** | é«˜ | é«˜ | å®šæœŸå®‰å…¨æ‰«æï¼ŒåŠæ—¶æ›´æ–° |
| **èµ„æºè€—å°½** | ä¸­ | ä¸­ | èµ„æºç›‘æ§ï¼Œè‡ªåŠ¨æ‰©å®¹ |
| **é…ç½®é”™è¯¯** | ä¸­ | ä¸­ | é…ç½®ç®¡ç†ï¼Œå˜æ›´å®¡è®¡ |

### 4.3 ç¼“è§£ç­–ç•¥å®æ–½

#### 4.3.1 è‡ªåŠ¨æ¢å¤æœºåˆ¶
```yaml
# Docker Composeé‡å¯ç­–ç•¥
services:
  frontend:
    restart: unless-stopped
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
```

#### 4.3.2 ç›‘æ§å‘Šè­¦é…ç½®
```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
- name: huanu-alerts
  rules:
  - alert: HighMemoryUsage
    expr: container_memory_usage_bytes{name="huanu-frontend"} > 1073741824
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Frontend memory usage is high"
```

#### 4.3.3 å¤‡ä»½ç­–ç•¥
```bash
# æ¯æ—¥è‡ªåŠ¨å¤‡ä»½è„šæœ¬
#!/bin/bash
BACKUP_DIR="/backup/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# æ•°æ®åº“å¤‡ä»½
docker-compose exec postgres pg_dump -U huanu huanu > $BACKUP_DIR/database.sql

# æ–‡ä»¶æ•°æ®å¤‡ä»½
docker run --rm -v huanu_data:/data -v $BACKUP_DIR:/backup alpine tar czf /backup/data.tar.gz -C /data .

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨
aws s3 cp $BACKUP_DIR s3://huanu-backup/$(date +%Y%m%d)/ --recursive
```

---

## 5. å…·ä½“æ‰§è¡Œæ­¥éª¤

### 5.1 æ—¶é—´çº¿å®‰æ’

```mermaid
gantt
    title HuanuCanvaséƒ¨ç½²æ—¶é—´çº¿
    dateFormat X
    axisFormat %H:%M
    
    section é˜¶æ®µ1: å‡†å¤‡å·¥ä½œ
    é¡¹ç›®å¤‡ä»½              :done, prep1, 0, 30m
    ç¯å¢ƒæ£€æŸ¥              :done, prep2, 30m, 30m
    
    section é˜¶æ®µ2: ç¯å¢ƒæ­å»º
    Dockerå®‰è£…            :active, env1, 60m, 60m
    ä¾èµ–å®‰è£…              :env2, 120m, 60m
    
    section é˜¶æ®µ3: åº”ç”¨æ„å»º
    å‰ç«¯æ„å»º              :build1, 180m, 45m
    åç«¯é…ç½®              :build2, 225m, 45m
    
    section é˜¶æ®µ4: éƒ¨ç½²éªŒè¯
    æœåŠ¡å¯åŠ¨              :deploy1, 270m, 30m
    åŠŸèƒ½éªŒè¯              :deploy2, 300m, 30m
    
    section é˜¶æ®µ5: ç›‘æ§é…ç½®
    ç›‘æ§éƒ¨ç½²              :monitor1, 330m, 30m
```

### 5.2 è¯¦ç»†æ‰§è¡Œå‘½ä»¤

#### 5.2.1 å¿«é€Ÿéƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# deploy.sh - ä¸€é”®éƒ¨ç½²è„šæœ¬

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "ğŸš€ å¼€å§‹éƒ¨ç½²HuanuCanvas..."

# æ£€æŸ¥ç¯å¢ƒ
check_environment() {
    echo "ğŸ” æ£€æŸ¥éƒ¨ç½²ç¯å¢ƒ..."
    
    if ! command -v docker &> /dev/null; then
        echo "âŒ Dockeræœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker"
        exit 1
    fi
    
    if ! command -v docker-compose &> /dev/null; then
        echo "âŒ Docker Composeæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker Compose"
        exit 1
    fi
    
    echo "âœ… ç¯å¢ƒæ£€æŸ¥é€šè¿‡"
}

# å‡†å¤‡ç¯å¢ƒ
prepare_environment() {
    echo "ğŸ”§ å‡†å¤‡éƒ¨ç½²ç¯å¢ƒ..."
    
    # åˆ›å»ºå¿…è¦ç›®å½•
    mkdir -p ssl logs backup
    
    # è®¾ç½®ç¯å¢ƒå˜é‡
    if [ ! -f .env ]; then
        cp deployment/.env.example .env
        echo "âš ï¸  è¯·ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ­£ç¡®çš„é…ç½®"
        echo "ğŸ“ ç‰¹åˆ«éœ€è¦è®¾ç½® GEMINI_API_KEY"
        read -p "æŒ‰å›è½¦ç»§ç»­..." 
    fi
    
    echo "âœ… ç¯å¢ƒå‡†å¤‡å®Œæˆ"
}

# æ„å»ºåº”ç”¨
build_application() {
    echo "ğŸ—ï¸  æ„å»ºåº”ç”¨..."
    
    # æ„å»ºå‰ç«¯
    echo "æ„å»ºå‰ç«¯åº”ç”¨..."
    npm ci
    npm run build
    
    # æ„å»ºDockeré•œåƒ
    echo "æ„å»ºDockeré•œåƒ..."
    docker build -f deployment/Dockerfile.frontend -t huanu-canvas:v1.4.1 .
    docker build -f deployment/Dockerfile.backend -t huan
