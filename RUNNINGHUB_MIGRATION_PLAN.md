# RunningHubèŠ‚ç‚¹æ¶æ„è¿ç§»é›†æˆè®¡åˆ’

## ğŸ“‹ å½“å‰çŠ¶æ€åˆ†æ

### æ ¸å¿ƒé—®é¢˜ç¡®è®¤
1. **Canvasæ³¨å†Œè¡¨çŠ¶æ€**: `Canvas/index.tsx` ä»æ³¨å†Œæ—§ç»„ä»¶ `RunningHubNode`
2. **æ–°ç»„ä»¶ä½¿ç”¨æƒ…å†µ**: `SimpleRunningHubNode` ä»…åœ¨æ¼”ç¤ºç»„ä»¶ä¸­ä½¿ç”¨
3. **ç³»ç»Ÿé›†æˆçŠ¶æ€**: ä¸»Canvasä»æœªä½¿ç”¨è¿‡æ–°ç»„ä»¶
4. **æ¥å£å·®å¼‚**: ä¸¤ä¸ªç»„ä»¶å­˜åœ¨æ˜¾è‘—çš„æ¥å£å’Œæ•°æ®ç»“æ„å·®å¼‚

### ä»£ç ç»Ÿè®¡å¯¹æ¯”
| ç»„ä»¶ | è¡Œæ•° | å¤æ‚åº¦ | æ¶æ„ç‰¹ç‚¹ |
|------|------|--------|----------|
| RunningHubNode (æ—§) | 626è¡Œ | é«˜ | å•ä½“ç»„ä»¶ï¼ŒçŠ¶æ€ç®¡ç†å¤æ‚ |
| SimpleRunningHubNode (æ–°) | 337è¡Œ | ä¸­ | åˆ†ç¦»å…³æ³¨ç‚¹ï¼ŒæœåŠ¡å±‚æŠ½è±¡ |

## ğŸ¯ è¿ç§»ç›®æ ‡

### æ€»ä½“ç›®æ ‡
- å°†Canvasç³»ç»Ÿä¸­çš„RunningHubèŠ‚ç‚¹ä»æ—§æ¶æ„è¿ç§»åˆ°æ–°æ¶æ„
- ä¿æŒ100%åŠŸèƒ½å…¼å®¹æ€§
- æå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
- å¢å¼ºæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

### å…·ä½“ç›®æ ‡
1. **æ¥å£ç»Ÿä¸€**: å»ºç«‹ç»Ÿä¸€çš„æ•°æ®æ¥å£è§„èŒƒ
2. **åŠŸèƒ½ä¿æŒ**: ç¡®ä¿ç°æœ‰åŠŸèƒ½å®Œå…¨æ­£å¸¸å·¥ä½œ
3. **æ€§èƒ½æå‡**: å‡å°‘ä»£ç é‡ï¼Œæå‡æ¸²æŸ“æ€§èƒ½
4. **æ¶æ„ä¼˜åŒ–**: å®ç°å…³æ³¨ç‚¹åˆ†ç¦»å’ŒæœåŠ¡å±‚æŠ½è±¡

## ğŸ“Š è¯¦ç»†è¿ç§»è®¡åˆ’

### é˜¶æ®µ1: æ¥å£é€‚é…å±‚è®¾è®¡ (é¢„è®¡2-3å°æ—¶)

#### 1.1 æ¥å£å·®å¼‚åˆ†æ
```typescript
// æ—§æ¥å£ (RunningHubCanvasNodeData)
interface RunningHubCanvasNodeData extends CanvasNodeData {
  webappId?: string;
  apiKey?: string;
  inputFields?: RunningHubNode[];
  onOpenConfig?: () => void;
  onTaskComplete?: (output: any) => void;
}

// æ–°æ¥å£ (SimpleRunningHubNodeData)
interface RunningHubNodeData {
  label: string;
  config: RunningHubConfig;
  inputs: RunningHubInput[];
  outputs: RunningHubOutput[];
  status: TaskStatus;
  progress: number;
  result?: TaskResult;
  isConfigured: boolean;
  apiKey?: string;
}
```

#### 1.2 åˆ›å»ºé€‚é…å™¨ç±»
```typescript
class RunningHubNodeAdapter {
  // å°†æ—§æ¥å£è½¬æ¢ä¸ºæ–°æ¥å£
  static adaptOldToNew(oldData: RunningHubCanvasNodeData): RunningHubNodeData
  
  // å°†æ–°æ¥å£è½¬æ¢å›æ—§æ¥å£ï¼ˆç”¨äºå…¼å®¹ï¼‰
  static adaptNewToOld(newData: RunningHubNodeData): RunningHubCanvasNodeData
}
```

#### 1.3 æ•°æ®æ˜ å°„ç­–ç•¥
- `webappId` â†’ `config.nodeType`
- `inputFields` â†’ `inputs`
- çŠ¶æ€æ˜ å°„å’Œè¿›åº¦åŒæ­¥
- ç»“æœæ ¼å¼ç»Ÿä¸€

### é˜¶æ®µ2: Canvasæ³¨å†Œè¡¨æ›´æ–° (é¢„è®¡1å°æ—¶)

#### 2.1 æ›´æ–°Canvas/index.tsx
```typescript
// ä¿®æ”¹å¯¼å…¥
- import RunningHubNode from './nodes/RunningHubNode';
+ import SimpleRunningHubNode from './nodes/SimpleRunningHubNode';

// ä¿®æ”¹æ³¨å†Œ
- runninghub: RunningHubNode,
+ runninghub: SimpleRunningHubNode,
```

#### 2.2 èŠ‚ç‚¹ç±»å‹å®šä¹‰æ›´æ–°
```typescript
// æ›´æ–°CanvasNodeDataæ¥å£ï¼Œç¡®ä¿å…¼å®¹æ€§
export interface CanvasNodeData {
  // ... ç°æœ‰å­—æ®µ
  // æ–°å¢å­—æ®µç”¨äºæ”¯æŒæ–°æ¶æ„
  config?: RunningHubConfig;
  inputs?: RunningHubInput[];
  outputs?: RunningHubOutput[];
  status?: TaskStatus;
  result?: TaskResult;
}
```

### é˜¶æ®µ3: ç»„ä»¶é€æ­¥æ›¿æ¢ (é¢„è®¡2-3å°æ—¶)

#### 3.1 åˆ›å»ºæ¸è¿›å¼è¿ç§»åŒ…è£…å™¨
```typescript
const RunningHubMigrationWrapper: React.FC<NodeProps<CanvasNodeData>> = ({ 
  id, 
  data, 
  selected 
}) => {
  // æ£€æµ‹æ•°æ®æ ¼å¼
  const isNewFormat = data.config && data.inputs;
  
  if (isNewFormat) {
    // ä½¿ç”¨æ–°ç»„ä»¶
    return <SimpleRunningHubNode id={id} data={data} selected={selected} />;
  } else {
    // æš‚æ—¶ä½¿ç”¨é€‚é…å™¨åŒ…è£…æ—§æ•°æ®æ ¼å¼
    const adaptedData = RunningHubNodeAdapter.adaptOldToNew(data);
    return <SimpleRunningHubNode id={id} data={adaptedData} selected={selected} />;
  }
};
```

#### 3.2 ç»Ÿä¸€é…ç½®ç®¡ç†
- æ›´æ–° `handleRunningHubFunctionSelect` æ–¹æ³•
- ç¡®ä¿ä¼ é€’ç»™ç»„ä»¶çš„æ•°æ®æ ¼å¼ç»Ÿä¸€
- å¤„ç†é…ç½®éªŒè¯å’Œé”™è¯¯çŠ¶æ€

### é˜¶æ®µ4: åŠŸèƒ½éªŒè¯å’Œæµ‹è¯• (é¢„è®¡2å°æ—¶)

#### 4.1 åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•
- [ ] CanvasèŠ‚ç‚¹åˆ›å»º
- [ ] é…ç½®ä¿å­˜å’ŒåŠ è½½
- [ ] ä»»åŠ¡æäº¤å’ŒçŠ¶æ€è·Ÿè¸ª
- [ ] ç»“æœå±•ç¤ºå’Œå¤„ç†
- [ ] é”™è¯¯å¤„ç†å’Œæ¢å¤

#### 4.2 æ€§èƒ½å¯¹æ¯”æµ‹è¯•
- [ ] ç»„ä»¶æ¸²æŸ“æ—¶é—´
- [ ] å†…å­˜ä½¿ç”¨æƒ…å†µ
- [ ] å“åº”é€Ÿåº¦æµ‹è¯•
- [ ] å¹¶å‘ä»»åŠ¡å¤„ç†

### é˜¶æ®µ5: æ¸…ç†å’Œä¼˜åŒ– (é¢„è®¡1å°æ—¶)

#### 5.1 ä»£ç æ¸…ç†
- ç§»é™¤æ—§çš„ `RunningHubNode.tsx` æ–‡ä»¶
- æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥å’Œä¾èµ–
- æ›´æ–°ç›¸å…³æ–‡æ¡£

#### 5.2 æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½
- å‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
- å®ç°æ‡’åŠ è½½

## ğŸ”§ å…·ä½“å®æ–½æ­¥éª¤

### æ­¥éª¤1: å‡†å¤‡å·¥ä½œ
```bash
# åˆ›å»ºå¤‡ä»½
cp -r src/frontend/components/Canvas/nodes/RunningHubNode.tsx src/frontend/components/Canvas/nodes/RunningHubNode.tsx.backup

# åˆ›å»ºè¿ç§»åˆ†æ”¯
git checkout -b runninghub-migration
```

### æ­¥éª¤2: åˆ›å»ºé€‚é…å™¨
åˆ›å»ºæ–‡ä»¶: `src/frontend/components/Canvas/nodes/RunningHubNodeAdapter.ts`

### æ­¥éª¤3: æ›´æ–°Canvasæ³¨å†Œè¡¨
ä¿®æ”¹æ–‡ä»¶: `src/frontend/components/Canvas/index.tsx`

### æ­¥éª¤4: æ¸è¿›å¼è¿ç§»
ä½¿ç”¨åŒ…è£…å™¨ç»„ä»¶é€æ­¥æ›¿æ¢

### æ­¥éª¤5: å…¨é¢æµ‹è¯•
æ‰§è¡ŒåŠŸèƒ½æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•

## âš ï¸ é£é™©è¯„ä¼°ä¸å›æ»šæ–¹æ¡ˆ

### é£é™©ç‚¹
1. **æ¥å£ä¸å…¼å®¹**: å¯èƒ½å¯¼è‡´ç°æœ‰èŠ‚ç‚¹æ— æ³•æ­£å¸¸å·¥ä½œ
2. **çŠ¶æ€ç®¡ç†**: çŠ¶æ€åŒæ­¥å¯èƒ½å‡ºç°é—®é¢˜
3. **APIè°ƒç”¨**: æ–°çš„APIæœåŠ¡è°ƒç”¨æ–¹å¼å¯èƒ½ä¸å…¼å®¹

### å›æ»šæ–¹æ¡ˆ
```bash
# å¿«é€Ÿå›æ»šå‘½ä»¤
git checkout HEAD~1
git checkout -b emergency-rollback
```

### åˆ†æ­¥å›æ»šç­–ç•¥
1. **é˜¶æ®µ1å›æ»š**: æ¢å¤Canvasæ³¨å†Œè¡¨
2. **é˜¶æ®µ2å›æ»š**: é‡æ–°å¯ç”¨æ—§ç»„ä»¶
3. **é˜¶æ®µ3å›æ»š**: å®Œå…¨å›æ»šåˆ°è¿ç§»å‰çŠ¶æ€

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### ä»£ç è´¨é‡æå‡
- **ä»£ç é‡å‡å°‘**: ä»626è¡Œå‡å°‘åˆ°~200è¡Œ (68%å‡å°‘)
- **å¯ç»´æŠ¤æ€§**: åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œæ¨¡å—åŒ–è®¾è®¡
- **æµ‹è¯•æ€§**: å•å…ƒæµ‹è¯•è¦†ç›–æ›´å®¹æ˜“

### æ€§èƒ½æå‡
- **æ¸²æŸ“æ—¶é—´**: å‡å°‘50%+
- **å†…å­˜ä½¿ç”¨**: å‡å°‘30%+
- **å“åº”é€Ÿåº¦**: å³æ—¶é¢„è§ˆåŠŸèƒ½

### åŠŸèƒ½å¢å¼º
- **å³æ—¶é¢„è§ˆ**: è¾“å…¥å˜åŒ–ç«‹å³æ˜¾ç¤ºé¢„è§ˆ
- **å¼‚æ­¥å¤„ç†**: åå°ä»»åŠ¡å¤„ç†
- **çŠ¶æ€ç®¡ç†**: å®Œå–„çš„ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª
- **é”™è¯¯å¤„ç†**: æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ¢å¤

## ğŸ“ éªŒè¯æ¸…å•

### è¿ç§»å‰éªŒè¯
- [ ] ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] å¤‡ä»½å®Œæ•´åˆ›å»º
- [ ] è¿ç§»ç¯å¢ƒå‡†å¤‡å°±ç»ª

### è¿ç§»ä¸­éªŒè¯
- [ ] é€‚é…å™¨æ­£å¸¸å·¥ä½œ
- [ ] ç»„ä»¶æ³¨å†ŒæˆåŠŸ
- [ ] æ•°æ®æ ¼å¼è½¬æ¢æ­£ç¡®

### è¿ç§»åéªŒè¯
- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡æ”¹å–„
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] é”™è¯¯å¤„ç†å®Œå–„

## ğŸš€ æ‰§è¡Œæ—¶é—´çº¿

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ | å…³é”®é‡Œç¨‹ç¢‘ |
|------|----------|------------|
| é˜¶æ®µ1: é€‚é…å±‚è®¾è®¡ | 2-3å°æ—¶ | é€‚é…å™¨åˆ›å»ºå®Œæˆ |
| é˜¶æ®µ2: Canvasæ›´æ–° | 1å°æ—¶ | æ³¨å†Œè¡¨æ›´æ–°å®Œæˆ |
| é˜¶æ®µ3: ç»„ä»¶æ›¿æ¢ | 2-3å°æ—¶ | åŒ…è£…å™¨å®ç°å®Œæˆ |
| é˜¶æ®µ4: æµ‹è¯•éªŒè¯ | 2å°æ—¶ | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |
| é˜¶æ®µ5: æ¸…ç†ä¼˜åŒ– | 1å°æ—¶ | ä»£ç æ¸…ç†å®Œæˆ |

**æ€»è®¡é¢„è®¡æ—¶é—´**: 8-10å°æ—¶

## ğŸ“‹ å®æ–½æ£€æŸ¥ç‚¹

### å…³é”®æ£€æŸ¥ç‚¹
1. **é€‚é…å™¨éªŒè¯**: æ•°æ®è½¬æ¢100%å‡†ç¡®
2. **æ³¨å†Œè¡¨æµ‹è¯•**: æ–°ç»„ä»¶æ­£ç¡®æ³¨å†Œ
3. **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰æ—§åŠŸèƒ½æ­£å¸¸å·¥ä½œ
4. **æ€§èƒ½éªŒè¯**: æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°é¢„æœŸ
5. **ä»£ç å®¡æŸ¥**: ä»£ç è´¨é‡ç¬¦åˆæ ‡å‡†

### æˆåŠŸæ ‡å‡†
- [ ] ç°æœ‰Canvaså·¥ä½œæµ100%å…¼å®¹
- [ ] æ–°åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ€§èƒ½æŒ‡æ ‡æ”¹å–„æ˜æ˜¾
- [ ] ä»£ç å¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡
- [ ] æ— å›å½’é—®é¢˜

---

**ä¸‹ä¸€æ­¥**: å¼€å§‹æ‰§è¡Œé˜¶æ®µ1 - æ¥å£é€‚é…å±‚è®¾è®¡
